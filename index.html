<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VNDXS Network - Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        .font-arabic { font-family: 'IBM Plex Sans Arabic', sans-serif; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .bg-gradient-custom { background: linear-gradient(135deg, #0a0a0a 0%, #1e3a8a 100%); }
    </style>
</head>
<body class="bg-black text-white font-arabic min-h-screen dir-rtl">
    
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-orbitron mb-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
                VNDXS Network
            </h1>
            <p class="text-gray-400 text-lg">Ù…Ø¯ÙˆÙ†Ø© VNDXS Ø§Ù„Ø±Ø³Ù…ÙŠØ©</p>
        </header>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø± -->
        <div class="bg-gray-900 rounded-2xl p-6 mb-8 border border-gray-700">
            <h2 class="text-xl font-bold mb-4">âœï¸ Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯</h2>
            <input type="text" id="postTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù†Ø´ÙˆØ±" class="w-full p-3 bg-gray-800 rounded-lg mb-3 border border-gray-600 focus:border-blue-500">
            <textarea id="postContent" placeholder="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±..." rows="4" class="w-full p-3 bg-gray-800 rounded-lg mb-3 border border-gray-600 focus:border-blue-500"></textarea>
            
            <div class="mb-4">
                <input type="file" id="postImage" accept="image/*" class="hidden">
                <label for="postImage" class="cursor-pointer bg-gray-800 border border-dashed border-gray-600 rounded-lg p-4 text-center block">
                    <span class="text-gray-400">ğŸ“¸ Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
                </label>
                <div id="imagePreview" class="mt-2"></div>
            </div>

            <button onclick="publishPost()" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-all">
                ğŸš€ Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±
            </button>
        </div>

        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª -->
        <div id="postsContainer">
            <div class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p class="text-gray-400">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª...</p>
            </div>
        </div>
    </div>

    <script>
        // ØªÙƒÙˆÙŠÙ† Supabase - Ø¨Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const supabaseUrl = 'https://ervicxogdkgrsbmqelnh.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVydmljeG9nZGtncnNibXFlbG5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxMDAwMTIsImV4cCI6MjA3OTY3NjAxMn0.vZ7Ie9bBvoRCGXIs1M9nIjHCG-5fYLaMdqoNFz_rOwg';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let selectedImage = null;

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø©
        document.getElementById('postImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                selectedImage = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = `
                        <img src="${e.target.result}" class="w-32 h-32 object-cover rounded-lg border border-gray-600">
                    `;
                };
                reader.readAsDataURL(file);
            }
        });

        // Ø¯Ø§Ù„Ø© Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
        async function uploadImage(file) {
            try {
                const fileName = `posts/${Date.now()}_${file.name}`;
                
                const { data, error } = await supabase.storage
                    .from('blog-images')
                    .upload(fileName, file);

                if (error) throw error;
                
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¹Ø§Ù…
                const { data: { publicUrl } } = supabase.storage
                    .from('blog-images')
                    .getPublicUrl(fileName);
                    
                return publicUrl;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©:', error);
                throw error;
            }
        }

        // Ø¯Ø§Ù„Ø© Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±
        async function publishPost() {
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            
            if (!title || !content) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰');
                return;
            }

            const publishBtn = document.querySelector('button[onclick="publishPost()"]');
            publishBtn.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';
            publishBtn.disabled = true;

            try {
                let imageUrl = null;
                
                // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (selectedImage) {
                    imageUrl = await uploadImage(selectedImage);
                }

                // Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const { data, error } = await supabase
                    .from('posts')
                    .insert([
                        {
                            title: title,
                            content: content,
                            image_url: imageUrl,
                            created_at: new Date().toISOString(),
                            likes: 0
                        }
                    ])
                    .select();

                if (error) throw error;

                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                document.getElementById('postTitle').value = '';
                document.getElementById('postContent').value = '';
                document.getElementById('imagePreview').innerHTML = '';
                selectedImage = null;

                alert('âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
                loadPosts(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±: ' + error.message);
            } finally {
                publishBtn.innerHTML = 'ğŸš€ Ù†Ø´Ø± Ø§Ù„Ù…Ù†Ø´ÙˆØ±';
                publishBtn.disabled = false;
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
        async function loadPosts() {
            try {
                const { data: posts, error } = await supabase
                    .from('posts')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const container = document.getElementById('postsContainer');
                
                if (!posts || posts.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <p class="text-gray-400 text-lg">ğŸ“ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¨Ø¹Ø¯</p>
                            <p class="text-gray-600 mt-2">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ†Ø´Ø±!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = posts.map(post => `
                    <div class="bg-gray-900 rounded-2xl p-6 mb-6 border border-gray-700">
                        <h3 class="text-xl font-bold mb-3 text-white">${post.title}</h3>
                        <p class="text-gray-300 mb-4 leading-relaxed">${post.content}</p>
                        
                        ${post.image_url ? `
                            <img src="${post.image_url}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±" class="w-full rounded-lg mb-4 max-h-96 object-cover">
                        ` : ''}
                        
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <span>${new Date(post.created_at).toLocaleDateString('ar-EG')}</span>
                            <span>â¤ï¸ ${post.likes} Ø¥Ø¹Ø¬Ø§Ø¨</span>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª:', error);
                container.innerHTML = `
                    <div class="text-center py-12 text-red-400">
                        âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
                    </div>
                `;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            loadPosts();
        });
    </script>
</body>
</html>
